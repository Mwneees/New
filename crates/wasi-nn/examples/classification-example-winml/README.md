This example project demonstrates using the `wasi-nn` API to perform WinML based inference. We will firstly build wasmtime, a fast and secure runtime for WebAssembly, and then build a WebAssembly application which classifies images. The application reads input picture from crates\wasi-nn\examples\classification-example-winml\fixture\kitten.png, convert to tensor data, then inference with crates\wasi-nn\examples\classification-example-winml\fixture\mobilenet.onnx. The example is written in Rust. However, you can write your WebAssembly application with other languages you like, and compile it as a WebAssembly binary.

To run this example, please run following steps on Windows 10 1803 and later.

1. Download rust from https://www.rust-lang.org/tools/install, and install. It may also install Visual C++ prerequisites if they are not installed.
1. Install `wasm32-wasi` Rust standard library
    ```
    rustup target add wasm32-wasi
    ```
1. Install git from https://www.git-scm.com/.
1. Clone this project.
    ```
    git clone https://github.com/intel-sandbox/wasmtime-wasi-nn.git
    ```
1. Navigate to wasmtime-wasi-nn directory.
    ```
    cd wasmtime-wasi-nn
    ```
1. Switch to winml-example branch.
    ```
    git checkout winml-example
    ```
1. Ensure all submudules are initialized.
    ```
    git submodule update --init
    ```
1. Compile wasmtime with wasi-nn enabled. This step generates the wasmtime executable binary, which is a runtime for WebAssembly.
    ```
    cargo build --release -p wasmtime-cli --features wasmtime-wasi-nn/winml
    ```
1. Navigate to wasi-nn WinML backend example directory.
    ```
    cd crates\wasi-nn\examples\classification-example-winml
    ```
1. Compile the example. The wasm32-wasi target makes the output to be a wasm file.
    ```
    cargo build --release --target=wasm32-wasi
    ```
1. Navigate back to wasmtime directory.
    ```
    cd ../../../..
    ```
1. Run the sample. The fixture directory is specified here for input models and images. The wasm file was generated by step 10. You can replace it with another wasm binary uses wasi-nn APIs.
    ```
    .\target\release\wasmtime.exe --dir .\crates\wasi-nn\examples\classification-example-winml\fixture::fixture -S nn .\crates\wasi-nn\examples\classification-example-winml\target\wasm32-wasi\release\wasi-nn-example-winml.wasm
    ```
1. It will show results with the top 5 possibilities.
1. If you want to play with a different image, simply replace fixture/kitten.png with another picture.
1. If you want to try a different model, replace mobilenet.onnx with another ONNX model. Depends on your new model's requirement, you may need to change the parameters for preprocessing.