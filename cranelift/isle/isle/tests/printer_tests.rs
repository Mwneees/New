//! Auto-generated ISLE printer tests.

use cranelift_isle::lexer;
use cranelift_isle::parser;
use cranelift_isle::printer;
use std::io::BufWriter;
use std::iter::zip;

pub fn run_print(isle_filename: &str) {
    // Parse.
    let lexer = lexer::Lexer::from_files(&[isle_filename]).unwrap();
    let original = parser::parse_without_pos(lexer).unwrap();

    // Print.
    let mut buf = BufWriter::new(Vec::new());
    printer::print(&original, 78, &mut buf).unwrap();
    let bytes = buf.into_inner().unwrap();
    let isle_source = String::from_utf8(bytes).unwrap();

    // Round trip.
    let lexer = lexer::Lexer::from_str(&isle_source, "<string>").unwrap();
    let round_trip = parser::parse_without_pos(lexer).unwrap();

    // Ensure equal.
    assert_eq!(original.defs.len(), round_trip.defs.len());
    for (orig, rt) in zip(original.defs, round_trip.defs) {
        assert_eq!(orig, rt);
    }
}

// Generated by build.rs.
include!(concat!(env!("OUT_DIR"), "/isle_printer_tests.rs"));
